using NUnit.Framework;
using PhpVH.LexicalAnalysis;

namespace PhpVH.Tests.Unit.LexicalAnalysis
{
    [TestFixture]
    public class LexerHereDocTest
    {
        [Test, Category("PhpLexer")]
        public void Three_Less_Thans_Returns_HereDocString_Token()
        {
            TokenAssert.IsValid(new TokenPairs {
                { TokenType.OpenTag, "<?" },
                { TokenType.Variable, "$test" },
                { TokenType.AssignmentOperator, "=" },
                { TokenType.HereDocString, "<<<EOT\nEOT" },
                { TokenType.EndOfStatement, ";" },
                { TokenType.CloseTag, "?>" }
            });
        }

        [Test, Category("PhpLexer")]
        public void HereDoc_With_Other_Tokens_Returns_HereDocString_Token()
        {
            TokenAssert.IsValid(new TokenPairs {
                { TokenType.OpenTag, "<?" },
                { TokenType.HereDocString, "<<<EOT\n//@\n'test'\"value\"<<<\nEOT" },
                { TokenType.WhiteSpace, "\n" },
                { TokenType.CloseTag, "?>" }
            });
        }

        [Test, Category("PhpLexer")]
        public void HereDoc_Single_Quoted_Terminal_Returns_HereDocString_Token()
        {
            TokenAssert.IsValid(new TokenPairs {
                { TokenType.OpenTag, "<?" },
                { TokenType.HereDocString, "<<<'_EOT_'\ntest\n_EOT_" },
                { TokenType.WhiteSpace, "\n" },
                { TokenType.CloseTag, "?>" }
            });
        }

        [Test, Category("PhpLexer")]
        [Ignore("\"I've never hit it in the wild, heredocs are quite rare, and it's going to be a pain,\" said John Leitch.")]
        public void HereDoc_Double_Quoted_Terminal_Returns_HereDocString_Token()
        {
            TokenAssert.IsValid(new TokenPairs {
                { TokenType.OpenTag, "<?" },
                { TokenType.HereDocString, "<<<\"_EOT_\"\ntest\n_EOT_" },
                { TokenType.WhiteSpace, "\n" },
                { TokenType.CloseTag, "?>" }
            });
        }

        [Test, Category("PhpLexer")]
        public void HereDoc_With_Inner_HereDoc_Returns_HereDocString_Token()
        {
            TokenAssert.IsValid(new TokenPairs {
                { TokenType.OpenTag, "<?" },
                { TokenType.HereDocString, "<<<_EOT_\n<<<\n_EOT_" },
                { TokenType.WhiteSpace, "\n" },
                { TokenType.CloseTag, "?>" }
            });
        }

        [Test, Category("PhpLexer")]
        public void HereDoc_With_Extra_Whitespace_Returns_HereDocString_Token()
        {
            TokenAssert.IsValid(new TokenPairs {
                { TokenType.OpenTag, "<?" },
                { TokenType.HereDocString, "<<<\t \t _EOT_ \t \t\n<<<\n_EOT_" },
                { TokenType.WhiteSpace, "\n" },
                { TokenType.CloseTag, "?>" }
            });
        }

        [Test, Category("PhpLexer")]
        public void HereDoc_In_Arguments_Returns_HereDocString_Token()
        {
            TokenAssert.IsValid(new TokenPairs {
                { TokenType.OpenTag, "<?php" },
                { TokenType.Identifier, "var_dump" },
                { TokenType.LeftParenthesis, "(" },
                { TokenType.arrayKeyword, "array" },
                { TokenType.LeftParenthesis, "(" },
                { TokenType.HereDocString, "<<<EOD\nfoobar!\nEOD" },
                { TokenType.WhiteSpace, "\n" },
                { TokenType.RightParenthesis, ")" },
                { TokenType.RightParenthesis, ")" },
                { TokenType.EndOfStatement, ";" },
                { TokenType.WhiteSpace, "\n" },
                { TokenType.CloseTag, "?>" }
            });
        }
    }
}
