using System;
using System.IO;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml.Serialization;

namespace PhpVH
{
    public class ReportWriter
    {
        private List<ReportFile> _reportFiles = new List<ReportFile>();

        public List<ReportFile> ReportFiles
        {
            get { return _reportFiles; }
        }

        public DirectoryInfo ReportPath { get; private set; }

        public ReportWriter(string serverPath)
        {
            ReportPath = new DirectoryInfo(@".\Reports\" +
                serverPath.Replace('/', '_') + " Scan Reports " +
                DateTime.Now.ToString("MM-dd-yyyy-HHmmss"));
            ReportPath.Create();
        }

        public string Write(string name, string report, string extension)
        {
            var file = ReportPath + "\\" + name + "." + extension;

            _reportFiles.Add(new ReportFile(name, name + "." + extension));

            if (!string.IsNullOrEmpty(report.ToString()))
            {
                File.WriteAllText(file, report.ToString());

                Console.BackgroundColor = ConsoleColor.DarkBlue;
                Console.ForegroundColor = ConsoleColor.White;
                TraceHelper.WriteFormat("\r\n{0} report written to {1}", name, file);
                Console.ResetColor();
                TraceHelper.WriteLine();

                return file;
            }

            return null;
        }

        public string Write(string name, string report)
        {
            return Write(name, report, "txt");
        }

        public string WriteFilenames()
        {
            var filename = ReportPath + "\\files.rxml";
            using (var s = File.Create(filename))
                new XmlSerializer(typeof(List<ReportFile>)).Serialize(s, _reportFiles);
            return filename;
        }
    }
}
