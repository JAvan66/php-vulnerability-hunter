using Components.Aphid.Interpreter;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace Components.Aphid.Library
{
    [AphidLibrary("threading")]
    public class ThreadingLibrary
    {
        [AphidInteropFunction("async", true)]
        public static ManualResetEvent Async(AphidInterpreter interpreter, AphidFunction function, params object[] parms)
        {
            var reset = new ManualResetEvent(false);
            var interpreter2 = new AphidInterpreter(interpreter.CurrentScope);
            ThreadPool.QueueUserWorkItem(x =>
            {
                interpreter2.CallFunction(function, parms);
                reset.Set();
            });            
            return reset;
        }

        [AphidInteropFunction("join")]
        public static void Join(ManualResetEvent reset)
        {
            reset.WaitOne();
        }
    }
}
